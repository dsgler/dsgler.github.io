<!DOCTYPE html> <html><head>
<title>React Native调用Go</title>
<base href="..">
<meta name="pathname" content="android/react-native调用go.html">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
<meta charset="UTF-8">
<meta name="description" content="main - React Native调用Go">
<meta property="og:title" content="React Native调用Go">
<meta property="og:description" content="main - React Native调用Go">
<meta property="og:type" content="website">
<meta property="og:url" content="android/react-native调用go.html">
<meta property="og:image" content="android/attachments/react-native调用go-20250421.png">
<meta property="og:site_name" content="main">
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="site-lib/rss.xml"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-wasm-script" src="site-lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="site-lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="site-lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="site-lib/scripts/pixi.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="site-lib/scripts/minisearch.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:4px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#layout{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}#center-content>.obsidian-document>.markdown-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6):has(> :is(.math,table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){width:100%;height:100%;max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment] :is(audio){width:100%;max-width:90%}.obsidian-document[data-type=attachment] :is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const l=await fetch(e);if(!l.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await l.text()}else{const t=document.querySelector(`data[id='${encodeURI(e)}']`);if(t){const e=JSON.parse(decodeURI(t.getAttribute("value")??""));o=e?.data??""}}let l=document.createRange().createContextualFragment(o),n=Array.from(l.children);for(let e of n)e?.classList?.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e?.classList?.remove("hide")}),10);t.before(l),t.remove(),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(l){let n=o[l],i=l+1;n?(n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(i),l<o.length&&n.addEventListener("load",(()=>e(i)))):l<o.length?e(i):t()}(0)}</script></head><body class="publish css-settings-manager theme-dark mod-windows is-frameless is-hidden-frameless show-inline-title show-ribbon is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div id="layout"><div id="left-content" class="leaf"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><div id="search-container"><div id="search-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div aria-label="Clear search" id="search-clear-button"></div></div></div></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings allow-fold-lists show-indentation-guide show-properties" data-type="markdown"><style id="MJX-CHTML-styles"></style><div class="markdown-sizer"><div class="header"><h1 class="page-title heading inline-title" id="React Native调用Go">React Native调用Go</h1><div class="data-bar"></div></div><div class="markdown-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-p"><p dir="auto">因为有代码用go写好了，不想再写一遍，于是有了这篇文章。</p></div><div class="el-h2 heading-wrapper"><h2 data-heading="Go打包为Android" dir="auto" class="heading" id="Go打包为Android"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Go打包为Android</h2><div class="heading-children"><div class="el-p"><p dir="auto">首先，<code>gomobile</code>可以将<code>go</code>打包为<code>aar</code>文件供<code>Android</code>调用。<br>
<a data-tooltip-position="top" aria-label="https://pkg.go.dev/golang.org/x/mobile/cmd/gomobile" rel="noopener nofollow" class="external-link is-unresolved" href="https://pkg.go.dev/golang.org/x/mobile/cmd/gomobile" target="_self">gomobile</a><br>
<a data-tooltip-position="top" aria-label="https://pkg.go.dev/golang.org/x/mobile/cmd/gobind?utm_source=godoc#hdr-Type_restrictions" rel="noopener nofollow" class="external-link is-unresolved" href="https://pkg.go.dev/golang.org/x/mobile/cmd/gobind?utm_source=godoc#hdr-Type_restrictions" target="_self">gobind</a><br>
实际上还是编译成了<code>.so</code>文件，但是暴露接口供<code>java</code>调用，但是只有支持的类型才是可以导出的：<br>
At present, only a subset of Go types are supported.</p></div><div class="el-pre"><pre><code data-line="0">At present, only a subset of Go types are supported.

All exported symbols in the package must have types that are supported. Supported types include:

- Signed integer and floating point types.
    
- String and boolean types.
    
- Byte slice types. Note that byte slices are passed by reference, and support mutation.
    
- Any function type all of whose parameters and results have supported types. Functions must return either no results, one result, or two results where the type of the second is the built-in 'error' type.
    
- Any interface type, all of whose exported methods have supported function types.
    
- Any struct type, all of whose exported methods have supported function types and all of whose exported fields have supported types.
    

Unexported symbols have no effect on the cross-language interface, and as such are not restricted.

The set of supported types will eventually be expanded to cover more Go types, but this is a work in progress.

Exceptions and panics are not yet supported. If either pass a language boundary, the program will exit.
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">建议单独写一个文件用于导出，小写的字段不会被导出，所以类型无所谓，要保证想导出的类型都是支持的。</p></div><div class="el-p"><p dir="auto">打包的命令：</p></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded">gomobile <span class="token builtin class-name">bind</span> <span class="token parameter variable">-target</span><span class="token operator">=</span>android/arm64 <span class="token parameter variable">-androidapi</span> <span class="token number">24</span> hustLog/ancheck
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">会生成<code>.aar</code>和<code>.jar</code>文件，其中<code>.jar</code>文件是类型的声明，事实上直接反编译<code>.aar</code>也可以得到。</p></div><div class="el-p"><p dir="auto">将打包得到的文件放在<code>android</code>文件夹下的<code>app</code>下的<code>libs</code>文件夹中（如果没有就创建）<br>
在<code>app/build.gradle</code>中的<code>dependencies</code>里添加</p></div><div class="el-pre"><pre><code data-line="0">implementation (fileTree("libs"))
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">将<code>libs</code>里的文件加入编译。</p></div><div class="el-p"><p dir="auto"><span src="android/attachments/react-native调用go-20250421.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img src="android/attachments/react-native调用go-20250421.png" target="_self"></span><br>
点击这里同步一下，然后就可以开始写<code>Android</code>的桥架层了。</p></div><div class="el-hr"><hr></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Android侧桥接与注册" dir="auto" class="heading" id="Android侧桥接与注册"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Android侧桥接与注册</h2><div class="heading-children"><div class="el-p"><p dir="auto"><a data-tooltip-position="top" aria-label="https://reactnative.cn/docs/legacy/native-modules-android" rel="noopener nofollow" class="external-link is-unresolved" href="https://reactnative.cn/docs/legacy/native-modules-android" target="_self">Android 原生模块</a></p></div><div class="el-p"><p dir="auto">基本照着文档做就好了<br>
第一步是在&nbsp;<code>android/app/src/main/java/com/your-app-name/</code>&nbsp;文件夹中创建 Java/Kotlin 文件(<code>CalendarModule.java</code>&nbsp;或&nbsp;<code>CalendarModule.kt</code>)。</p></div><div class="el-p"><p dir="auto"><span src="android/attachments/react-native调用go-20250421-1.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img src="android/attachments/react-native调用go-20250421-1.png" target="_self"></span><br>
然后添加如下代码：</p></div><div class="el-pre"><pre class="language-kotlin" tabindex="0"><code data-line="0" class="language-kotlin is-loaded"><span class="token keyword">package</span> com<span class="token punctuation">.</span>your<span class="token operator">-</span>apps<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">-</span>name<span class="token punctuation">;</span> <span class="token comment">// replace your-apps-package-name with your app’s package name</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>NativeModule
<span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>ReactApplicationContext
<span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>ReactContext
<span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>ReactContextBaseJavaModule
<span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>ReactMethod

<span class="token keyword">class</span> <span class="token function">CalendarModule</span><span class="token punctuation">(</span>reactContext<span class="token operator">:</span> ReactApplicationContext<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">ReactContextBaseJavaModule</span><span class="token punctuation">(</span>reactContext<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">添加<code>getName()</code>获取模块名称</p></div><div class="el-pre"><pre class="language-kotlin" tabindex="0"><code data-line="0" class="language-kotlin is-loaded"><span class="token comment">// add to CalendarModule.kt  </span>
<span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"CalendarModule"</span></span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">其他就正常在<code>CalendarModule</code>里写，需要导出的方法加上<br>
<code>@ReactMethod</code>注解</p></div><div class="el-h3 heading-wrapper"><h3 data-heading="参数类型[​](https://reactnative.cn/docs/legacy/native-modules-android#%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B &quot;标题的直接链接&quot;)" dir="auto" class="heading" id="参数类型[​](https//reactnative.cn/docs/legacy/native-modules-android#%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B_&quot;标题的直接链接&quot;)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>参数类型<a data-tooltip-position="top" aria-label="https://reactnative.cn/docs/legacy/native-modules-android#%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B" rel="noopener nofollow" class="external-link is-unresolved" title="标题的直接链接" href="https://reactnative.cn/docs/legacy/native-modules-android#%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B" target="_self">​</a></h3><div class="heading-children"><div class="el-p"><p dir="auto">当在 JavaScript 中调用原生模块方法时，React Native 会将参数从 JS 对象转换为对应的 Java/Kotlin 对象类型。例如，如果你的 Java 原生模块方法接受一个 double 类型，在 JS 中你需要用数字来调用该方法。React Native 会为你处理转换。下面列出了原生模块方法支持的参数类型以及它们在 JavaScript 中对应的等价类型。</p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr">Java</th>
<th dir="ltr">Kotlin</th>
<th dir="ltr">JavaScript</th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr">Boolean</td>
<td dir="ltr">Boolean</td>
<td dir="ltr">?boolean</td>
</tr>
<tr>
<td dir="ltr">boolean</td>
<td dir="auto"></td>
<td dir="ltr">boolean</td>
</tr>
<tr>
<td dir="ltr">Double</td>
<td dir="ltr">Double</td>
<td dir="ltr">?number</td>
</tr>
<tr>
<td dir="ltr">double</td>
<td dir="auto"></td>
<td dir="ltr">number</td>
</tr>
<tr>
<td dir="ltr">String</td>
<td dir="ltr">String</td>
<td dir="ltr">string</td>
</tr>
<tr>
<td dir="ltr">Callback</td>
<td dir="ltr">Callback</td>
<td dir="ltr">Function</td>
</tr>
<tr>
<td dir="ltr">Promise</td>
<td dir="ltr">Promise</td>
<td dir="ltr">Promise</td>
</tr>
<tr>
<td dir="ltr">ReadableMap</td>
<td dir="ltr">ReadableMap</td>
<td dir="ltr">Object</td>
</tr>
<tr>
<td dir="ltr">ReadableArray</td>
<td dir="ltr">ReadableArray</td>
<td dir="ltr">Array</td>
</tr>
</tbody>
</table></div><div class="el-p"><p dir="auto">在<code>Android</code>向<code>js</code>传参时使用，与<code>ReadableMap</code>和<code>ReadableArray</code>对应</p></div><div class="el-pre"><pre class="language-kotlin" tabindex="0"><code data-line="0" class="language-kotlin is-loaded">WritableMap map <span class="token operator">=</span> Arguments<span class="token punctuation">.</span><span class="token function">createMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"id"</span></span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
map<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"name"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"小明"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

WritableArray array <span class="token operator">=</span> Arguments<span class="token punctuation">.</span><span class="token function">createArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
array<span class="token punctuation">.</span><span class="token function">pushString</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"哈哈1"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
array<span class="token punctuation">.</span><span class="token function">pushString</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"哈哈2"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">putArray</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"sub"</span></span><span class="token punctuation">,</span>array <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="信息传递" dir="auto" class="heading" id="信息传递"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>信息传递</h3><div class="heading-children"><div class="el-p"><p dir="auto">可以通过 <strong>回调函数</strong> 和 <strong>promise</strong>，这里使用 <strong>promise</strong><br>
当原生模块 Java/Kotlin 方法的最后一个参数为 Promise 时，对应的 JS 方法将返回一个 JS Promise 对象。</p></div><div class="el-pre"><pre class="language-kotlin" tabindex="0"><code data-line="0" class="language-kotlin is-loaded"><span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>Promise  
  
<span class="token annotation builtin">@ReactMethod</span>  
<span class="token keyword">fun</span> <span class="token function">createCalendarEvent</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String， location<span class="token operator">:</span> String， promise<span class="token operator">:</span> Promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
	<span class="token keyword">try</span> <span class="token punctuation">{</span>  
		<span class="token keyword">val</span> eventId <span class="token operator">=</span> <span class="token operator">..</span><span class="token punctuation">.</span>  
		promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>eventId<span class="token punctuation">)</span>  
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
		promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Create Event Error"</span></span>， e<span class="token punctuation">)</span>  
	<span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">还有一些别的 如 发送事件 ，自己看文档吧</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="信息存储" dir="auto" class="heading" id="信息存储"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>信息存储</h3><div class="heading-children"><div class="el-p"><p dir="auto">某些东西无法传到<code>js</code>里保存，建议在<code>go</code>里开一个<code>map</code>来保存，在<code>java</code>里保存会有问题，我怀疑是被回收了。</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="在 Android 上注册模块" dir="auto" class="heading" id="在_Android_上注册模块"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>在 Android 上注册模块</h3><div class="heading-children"><div class="el-p"><p dir="auto">要将你的原生模块添加到&nbsp;<code>ReactPackage</code>&nbsp;中，首先在&nbsp;<code>android/app/src/main/java/com/your-app-name/</code>&nbsp;文件夹中创建一个新的 Java/Kotlin 类(<code>MyAppPackage.java</code>&nbsp;或&nbsp;<code>MyAppPackage.kt</code>)，并实现&nbsp;<code>ReactPackage</code>&nbsp;接口:</p></div><div class="el-p"><p dir="auto">然后添加以下内容:</p></div><div class="el-pre"><pre class="language-kotlin" tabindex="0"><code data-line="0" class="language-kotlin is-loaded"><span class="token keyword">package</span> com<span class="token punctuation">.</span>your<span class="token operator">-</span>app<span class="token operator">-</span>name <span class="token comment">// replace your-app-name with your app’s name  </span>
  
<span class="token keyword">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>View  
<span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>ReactPackage  
<span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>NativeModule  
<span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>ReactApplicationContext  
<span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>uimanager<span class="token punctuation">.</span>ReactShadowNode  
<span class="token keyword">import</span> com<span class="token punctuation">.</span>facebook<span class="token punctuation">.</span>react<span class="token punctuation">.</span>uimanager<span class="token punctuation">.</span>ViewManager  
  
<span class="token keyword">class</span> MyAppPackage <span class="token operator">:</span> ReactPackage <span class="token punctuation">{</span>  
  
<span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">createViewManagers</span><span class="token punctuation">(</span>  
reactContext<span class="token operator">:</span> ReactApplicationContext  
<span class="token punctuation">)</span><span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>ViewManager<span class="token operator">&lt;</span>View<span class="token punctuation">,</span> ReactShadowNode<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">mutableListOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
  
<span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">createNativeModules</span><span class="token punctuation">(</span>  
reactContext<span class="token operator">:</span> ReactApplicationContext  
<span class="token punctuation">)</span><span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>NativeModule<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token function">CalendarModule</span><span class="token punctuation">(</span>reactContext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMutableList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">然后打开<code>MainApplication.java</code>或<code>MainApplication.kt</code>文件，位于如下路径:<code>android/app/src/main/java/com/your-app-name/</code>。</p></div><div class="el-p"><p dir="auto">找到 ReactNativeHost 的<code>getPackages()</code>方法，并将你的包添加到<code>getPackages()</code>返回的包列表中。</p></div><div class="el-pre"><pre class="language-kotlin" tabindex="0"><code data-line="0" class="language-kotlin is-loaded"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getPackages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>ReactPackage<span class="token operator">&gt;</span> <span class="token operator">=</span>  
<span class="token function">PackageList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>packages<span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span>  
<span class="token comment">// Packages that cannot be autolinked yet can be added manually here， for example:  </span>
<span class="token comment">// packages.add(new MyReactNativePackage());  </span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token function">MyAppPackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="在JS调用" dir="auto" class="heading" id="在JS调用"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>在JS调用</h2><div class="heading-children"><div class="el-pre"><pre class="language-tsx" tabindex="0"><code data-line="0" class="language-tsx is-loaded"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span><span class="token maybe-class-name">NativeModules</span><span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">'react-native'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token maybe-class-name">CalendarModule</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token maybe-class-name">NativeModules</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">建议自己写个类型</p></div><div class="el-p"><p dir="auto"><code>go</code>里的log可以在<code>logcat</code>里看到</p></div><div class="mod-footer mod-ui"></div></div></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable" href="android/react-native调用go.html#React Native调用Go" data-path="#React Native调用Go"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="React Native调用Go">React Native调用Go</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="android/react-native调用go.html#Go打包为Android" data-path="#Go打包为Android"><div class="tree-item-inner heading-link" heading-name="Go打包为Android">Go打包为Android</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable" href="android/react-native调用go.html#Android侧桥接与注册" data-path="#Android侧桥接与注册"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Android侧桥接与注册">Android侧桥接与注册</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="android/react-native调用go.html#参数类型[​](https//reactnative.cn/docs/legacy/native-modules-android#%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B_&quot;标题的直接链接&quot;)" data-path="#参数类型[​](https//reactnative.cn/docs/legacy/native-modules-android#%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B_&quot;标题的直接链接&quot;)"><div class="tree-item-inner heading-link" heading-name="参数类型[​](https://reactnative.cn/docs/legacy/native-modules-android#%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B &quot;标题的直接链接&quot;)">参数类型<span>​</span></div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="android/react-native调用go.html#信息传递" data-path="#信息传递"><div class="tree-item-inner heading-link" heading-name="信息传递">信息传递</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="android/react-native调用go.html#信息存储" data-path="#信息存储"><div class="tree-item-inner heading-link" heading-name="信息存储">信息存储</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="android/react-native调用go.html#在_Android_上注册模块" data-path="#在_Android_上注册模块"><div class="tree-item-inner heading-link" heading-name="在 Android 上注册模块">在 Android 上注册模块</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="android/react-native调用go.html#在JS调用" data-path="#在JS调用"><div class="tree-item-inner heading-link" heading-name="在JS调用">在JS调用</div></a><div class="tree-item-children"></div></div></div></div></div><div class="graph-view-wrapper"><div class="feature-header"><div class="feature-title">Interactive Graph</div></div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<div class="graph-icon graph-global" role="button" aria-label="Global Graph" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-git-fork"><circle cx="12" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="6" r="3"></circle><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path><path d="M12 12v3"></path></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></body></html>